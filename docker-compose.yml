# Monorepo Docker Compose - for ECS simulation or image-based deploy
# Build from repo root: docker compose build
# Build single app: docker compose build admin-web
#
# Local dev infra (db, keycloak): use docker-compose.local.yml via pnpm db:up
# Full stack: docker compose up admin-web examiner-web organization-web

services:
  admin-web:
    build:
      context: .
      dockerfile: apps/admin-web/Dockerfile
    image: thrive-admin-web:latest
    container_name: thrive-admin-web
    ports:
      - "3000:3000"
    env_file:
      - apps/admin-web/.env
    environment:
      - NODE_ENV=production
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/admin/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  examiner-web:
    build:
      context: .
      dockerfile: apps/examiner-web/Dockerfile
    image: thrive-examiner-web:latest
    container_name: thrive-examiner-web
    ports:
      - "3001:3001"
    env_file:
      - apps/examiner-web/.env
    environment:
      - NODE_ENV=production
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3001/examiner/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  organization-web:
    build:
      context: .
      dockerfile: apps/organization-web/Dockerfile
    image: thrive-organization-web:latest
    container_name: thrive-organization-web
    ports:
      - "3002:3002"
    env_file:
      - apps/organization-web/.env
    environment:
      - NODE_ENV=production
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3002/organization/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
